{% extends "layouts/base.html" %}

{% block title %} UI Tables {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<script>
    $(document).ready(function(){
       
        gateLink_get_batch_data(0,"{{Name}}",0);
       
        setInterval(function(){
            $.ajax({
                type: 'POST',
                url : "/get_link_info",
                data:{
                    gateLink_Name:$('#now_page_name').val(),
                    csrfmiddlewaretoken:getCookie("csrftoken"),
                },
                success: function(response){
                    console.log(response);
                    tmp_str = $("#input_running_batch_array").val();
                    console.log(tmp_str);
                    if( tmp_str != response.str_status)
                    {
                       
                        m_status = "";
                        for(kkk in response.batch)
                        {

                            temp_kkk = response.batch[kkk];
                            tmp1 = "#glb_batch_finish_time"+ response.batch[kkk]['batch_id'];
                           
                            $(tmp1).empty();
                            tmp2 = "#glb_batch_start_time"+ response.batch[kkk]['batch_id'];
                            $(tmp2).empty();
                            tmp3 = "#glb_batch_status"+ response.batch[kkk]['batch_id'];
                            $(tmp3).empty();
                            tmp4 = "#glb_batch_total"+ response.batch[kkk]['batch_id'];
                            $(tmp4).empty();
                            tmp5 = "#glb_batch_success"+ response.batch[kkk]['batch_id'];
                            $(tmp5).empty();
                            tmp6 = "#glb_batch_done"+ response.batch[kkk]['batch_id'];
                            $(tmp6).empty();
                            tmp7 = "#glb_batch_remains"+ response.batch[kkk]['batch_id'];
                            $(tmp7).empty();
                            tmp8 = "#glb_batch_fail"+ response.batch[kkk]['batch_id'];
                            $(tmp8).empty();
                            tmp9 = "#glb_gate_body"+ response.batch[kkk]['batch_id'];
                            $(tmp9).empty();
                            var temp ="Finish time:" + temp_kkk.finish_time;
                            $(tmp1).append(temp);
                            var temp ="Start time:" + temp_kkk.start_time;
                            $(tmp2).append(temp);
                            var temp ="Status:" + temp_kkk.status;
                            $(tmp3).append(temp);
                            var temp ="Total:" + temp_kkk.total;
                            $(tmp4).append(temp);
                            var temp ="Successd:" + temp_kkk.succeed;
                            $(tmp5).append(temp);
                            var temp ="Done:" + temp_kkk.done;
                            $(tmp6).append(temp);
                            var temp ="Remains:" +temp_kkk.remains;
                            $(tmp7).append(temp);
                            var temp ="Fails:" + temp_kkk.fail;
                            $(tmp8).append(temp);
                            var temp=""
                            for (var key in response.gate)
                            {
                                if(response.gate[key]['batch_id'] == response.batch[kkk]['batch_id'])
                                {
                                    var mm=response.gate[key];
                                    temp+="<tr><td>"+mm.inserted_text+"</td>";
                                    m_status += mm.status;
                                    if(mm.status == 1)
                                    {
                                        temp+="<td><div class=\"spinner-border text-muted\"></div> </td><td> <div class=\"spinner-border text-muted\"></div> </td><td> <div class=\"spinner-border text-muted\"></div> </td><td> <div class=\"spinner-border text-muted\"></div> </td><td> <div class=\"spinner-border text-muted\"></div> </td><td> Processing</td>";
                                    }
                                    else 
                                    {
                                        temp+="<td>"+mm.result1 +"</td><td>"+mm.result2 +"</td><td>"+mm.result3 +"</td><td>"+mm.result4 +"</td><td>"+mm.result5 +"</td><td>";
                                        if(mm.status == 0) temp+="In_Queue";
                                        else if(mm.status == 2) temp+="Fail";
                                        else if(mm.status == 3) temp+="Done";
                                        temp+="</td>"
                                    }
                                    temp+="</tr>"
                                }
                                
                            }
                            $(tmp9).append(temp);
                        }
                      
                        console.log(m_status);
                        document.getElementById('input_running_batch_array').value = m_status;
                      
                    }
                },
                error: function(response){
                    //alert('An error occured')
                }     
            });
        },1000);
    })

    function copy_result(m_batchID,type)//type:0-all,1-Success only ,2-Done only ,3-Fail only 
    {
        var m_checkedStr = "";
        tmpStr = "gl_cpy_checkbox_"+m_batchID;
        m_resulStr="";
        var markedCheckbox = document.getElementsByName(tmpStr);  
        console.log(markedCheckbox);
        var cnt = 0;
        for (var checkbox of markedCheckbox) {  
            if (checkbox.checked)  
            {
                cnt ++;
                if(checkbox.value == "DI")
                    m_resulStr +="Data as Inserted;";
                else if(checkbox.value == "SF1")
                    m_resulStr +="SQL Field 1;";
                else if(checkbox.value == "SF2")
                    m_resulStr +="SQL Field 2;";
                else if(checkbox.value == "SF3")
                    m_resulStr +="SQL Field 3;";   
                else if(checkbox.value == "SF4")
                    m_resulStr+="SQL Field 4;";
                else if(checkbox.value == "SF5")
                    m_resulStr +="SQL Field 5;";
                else if(checkbox.value == "ST")
                    m_resulStr +="status;";
                if(cnt == 1)
                    m_checkedStr += checkbox.value;
                else  m_checkedStr +="#"+ checkbox.value;
            }
        }  
        console.log(m_resulStr);
        if(m_checkedStr == "")
        {
            alert("Please select row");
        } 
        else
        {
            
            $.ajax
            (
                {
                    type: 'POST',
                    url : "/gl_copy_result",
                    data:{
                        seleted_data:m_checkedStr,
                        btType:type,
                        batchID:m_batchID,
                        csrfmiddlewaretoken:getCookie("csrftoken"),
                    },
                    success: function(response){
                        var $temp = $("<textarea>");
                        var sss = m_resulStr + "\r\n"+ response.result;
                        $("body").append($temp);
                        $temp.val(sss).select();
                                 
                        document.execCommand("copy");
                        $temp.remove();
                        console.log(sss)
                        
               
                     
                       
                           
                    },
                    error: function(response){
                        // alert('An error occured')
                    } 
                }
            )
        }
        
    }
    function GateLink_Send_Insertd_Data() {
        var getSelectedValue = document.querySelector( 'input[name="radio"]:checked');   
            if(getSelectedValue == null) 
            {   
                alert("Please Select Insert Format");  
            }  
            else
            {
                document.getElementById('status_inserted_format').value = "ok";
                var tmp_name = document.getElementById('now_page_name').value;
                alert(tmp_name);
                $.ajax({
                        type: 'POST',
                        url : "/Gl_Send_InsertData",
                        data:{
                            name:tmp_name,
                            seleted_data:getSelectedValue.value,
                            message:"FND",
                            csrfmiddlewaretoken:getCookie("csrftoken"),
                        },
                        success: function(response){
                            alert("Success Formart Select")
                            $("#database_insert_error").empty();
                            $("#gl_error_preivewData").empty();
                        },
                        error: function(response){
                           // alert('An error occured')
                        } 
                    }
                )
            }    
                
    }
    function GateLink_Send_Preview_Data() {
        var getSelectedValue = document.querySelector( 'input[name="radio"]:checked');  
        //alert(document.forms["gatelink_preview_form"]["GateLink_Send_Preview_Data"].value);
        str_pre = document.getElementById('gatelink_previewData_oh').value;
        tmp_inserted_data = str_pre.trim().split("\n");
        if(str_pre.trim() == "") return;
        tmp_inserted_real_data = [];
        var cnt = 0;
        for(kk in tmp_inserted_data)
        { 
            tmp_id_str="";
            if(tmp_inserted_data[kk].trim() != "")
            {
                for(kkk in tmp_inserted_data[kk])
                {
                    console.log(tmp_inserted_data[kk][kkk]);
                    if(tmp_inserted_data[kk][kkk]==" ")
                    {   
                        tmp_id_str +="*#*";
                        
                    } 
                    else{
                        tmp_id_str +=tmp_inserted_data[kk][kkk];
                    }
                }
                tmp_inserted_real_data.push(tmp_id_str);
            }

        }
        console.log(tmp_inserted_real_data);
        if(getSelectedValue == null ) 
        {   
            document.getElementById('gl_error_preivewData').innerHTML ="<a >Error!Select Format Check</a>"; 
        }  
        else
        {
            var tmp_name = document.getElementById('now_page_name').value;
            $.ajax({
                    type: 'POST',
                    url : "/GateLink_Send_Preview_Data",
                    data:{
                        page_name:tmp_name,
                        seleted_data:getSelectedValue.value,
                        gatelink_previewData_oo:str_pre,
                        csrfmiddlewaretoken:getCookie("csrftoken"),
                    },
                    success: function(response){
                        $("#database_insert_error").empty();
                        temp_str111="<div class = \"card-body\"><div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"> "    
                        temp_str111+="<table class=\"table table-bordered\" style=\"text-align: center;\"><thead><tr><th>id</th>";
                        for(kk in response.format_array)
                        {
                            temp_str111+="<th>"+response.format_array[kk]+"</th>"
                        }
                        temp_str111+="<th>CHECK</th></tr></thead><tbody>"
                        var tmp_id = 0;
                       
                        for(kk in response.data_array)
                        {
                            //if(response.data_array[kk].error == "count error\r\n") continue;
                               
                            tmp_id = parseInt(kk)+1;
                            var temp_return_str = ""
                            temp_str111+="<tr><td>"+tmp_id.toString()+"</td>";
                                temp_return_str =tmp_inserted_real_data[kk].toString()+"##";
                            
                            for(k in response.format_array)
                            {
                                
                                if(k == 0)
                                {
                                    temp_return_str += response.data_array[kk][response.format_array[k]];
                                    temp_str111+="<td>"+response.data_array[kk][response.format_array[k]]+"<p style=\"text-align: center;color: red;\">";
                                    temp_str111+=response.data_array[kk].error+"</p></td>"
                                } 
                                else
                                {
                                    temp_return_str+="#"+response.data_array[kk][response.format_array[k]];
                                    temp_str111+="<td>"+response.data_array[kk][response.format_array[k]]+"</td>"
                                }
                            }
                            temp_str111+="<td><input type=\"checkbox\" value =" +temp_return_str;
                            if(response.data_array[kk].error == "") 
                            {
                                temp_str111+=" name = \"check\" checked></td></tr>"
                            }
                            else
                            {
                                temp_str111+="></td></tr>"
                            }
                            console.log(temp_return_str);
                                
                        }
                   
                        temp_str111+="</table></div><hr></hr><div style =\"text-align:right;\"><button "
                        temp_str111+="class=\"btn btn-primary\" name=\"gatelink_get_batch_data\" onclick=\"gateLink_get_batch_data(4,'{{Name}}',0)\"  value=\"ok\" >Insert Data</button>"
                        temp_str111+="</div></div>"
                        
                        $("#gatelink_result_data").empty();
                        if(tmp_id != 0 )
                            $("#gatelink_result_data").append(temp_str111);
                    },
                    error: function(response){
                        //alert('An error occured')
                    } 
                }
            )
        }    
                
    }
    function gateLink_get_batch_data(m_type,name,batch_id)
    {
        m_tmpCheck="";
        if(m_type == 4)
        {
            var markedCheckbox = document.getElementsByName('check');
            cnt = 0;
            for (var checkbox of markedCheckbox)
            {  
               
                if (checkbox.checked)   
                {
                    cnt ++;
                    if(cnt == 1 ) m_tmpCheck+=checkbox.value;
                    else m_tmpCheck+="$$$"+checkbox.value;
                }
               
            }
            batch_id = m_tmpCheck;

        }
        console.log(m_tmpCheck);
        $("#gatelink_result_data").empty("");
        tmp = "<div class=\"spinner-border text-muted\"></div>"
        $("#gatelink_result_data").append(tmp);
        $.ajax
        ({
            type: 'POST',
            url : "/gateLink_get_batch_data",
            data:{
                type:m_type,
                name:name,
                batch_id:batch_id,
                csrfmiddlewaretoken:getCookie("csrftoken"),
            },
            success: function(response){
               // $("#hi_Content").empty();
                
                if(JSON.stringify(response).includes("trans_array"))
                {
                  
                }
                else
                {
                    $("#gatelink_batch_data").empty();
                    $("#input_running_batch_array").empty();
                    $("#gatelink_result_data").empty();
                    $("#input_running_batch_array").append(response.runnig_array);
                    tmp="";
                    
                    m_runningBatch_array=[];
                    cnt= 0;
                    for(key in response.batch_array)
                    {   
                        cnt++;
                        m_cnt = response.batch_array.length - cnt +1;
                        if(response.batch_array[key]['status'] == "Running")
                        {
                            
                            m_runningBatch_array.push(response.batch_array[key]['batch_id']);
                            tmp+="<div class=\"col-sm-12 grid-margin\"><div class=\"card\"><div class=\"card-header\"><div class =\"row\"> <input type =\"hidden\" id =\"msg_running_batch_id"+response.batch_array[key]['batch_id']+"\"  value =";
                            tmp+= response.batch_array[key]['batch_id']+"> <div class =\"col-sm-1\" id=\"glb_batch_id\">Batch ID:"+ m_cnt+"</div>";
                            tmp+="<div class =\"col-sm-4\" style=\"text-align: center;\"><a onclick =\"gateLink_get_batch_data(1,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"status_info\" style=\"color: red;cursor: pointer;\">STOP the process of this batch click here</a></div>"
                            tmp+="<div class =\"col-sm-3\" style=\"text-align: center;\" id=\"glb_batch_start_time"+response.batch_array[key]['batch_id']+"\" >Start time:"+response.batch_array[key]['start_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" style=\"text-align: right;\" id=\"glb_batch_finish_time"+response.batch_array[key]['batch_id']+"\">Finish time:--:--:--</div>";
                            tmp+="<div class =\"col-sm-2\" data-toggle=\"collapse\" href=\"#col_gate_link_"+response.batch_array[key]['batch_id']+"\" aria-expanded=\"false\" ><a style=\"cursor: pointer;\">Expand Frame</a></div>";
                            tmp+="</div> </div> <div class=\"card-body\"> <div class =\"row\">";
                            tmp+="<div class =\"col\" id = \"glb_batch_status"+response.batch_array[key]['batch_id']+"\">Status:"+response.batch_array[key]['status']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_total"+response.batch_array[key]['batch_id']+"\">Total:"+response.batch_array[key]['total']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_success"+response.batch_array[key]['batch_id']+"\">Successd:"+response.batch_array[key]['succeed']+"</div>"  ;
                            tmp+="<div class =\"col\" id = \"glb_batch_done"+response.batch_array[key]['batch_id']+"\">Done:"+response.batch_array[key]['done']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_fail"+response.batch_array[key]['batch_id']+"\">Fails:"+response.batch_array[key]['fail']+"</div>"   ;            
                            tmp+="<div class =\"col\" id = \"glb_batch_remains"+response.batch_array[key]['batch_id']+"\">Remains:"+response.batch_array[key]['remains']+"</div></div>" ;                             
                            tmp+="<div class=\"collapse\" id=\"col_gate_link_"+ response.batch_array[key]['batch_id'] +"\">";
                            tmp+="<div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"><table class=\"table table-bordered\" style=\"text-align: center;\" >";
                            tmp+="<thead><tr><th>Data as Inserted</th><th> SQL Field 1</th><th> SQL Field 2</th><th> SQL Field 3</th><th> SQL Field 4</th><th> SQL Field 5</th><th> Status </th></tr></thead>";
                            tmp+="<tbody id =\"glb_gate_body"+response.batch_array[key]['batch_id']+"\"></tbody></table></div>";
                            tmp+="<div style=\"margin-top:10px\"><form><a style=\"margin-right: 2%;color: red;\">Selected row copy data</a><label class=\"checkbox-inline\" style=\"margin-right:1%;\">";
                            tmp+="<input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\"value=\"DI\" checked>Data as Inserted</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"><input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF1\" checked>SQL Field 1</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF2\" checked>SQL Field 2</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF3\" checked>SQL Field 3</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF4\" checked>SQL Field 4</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF5\" checked>SQL Field 5</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"ST\" checked>Status</label></form></div>";
                            tmp+="<div class=\"row\" style=\"text-align:center;\">";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",0)\" name=\"copy_all_result\" class=\"btn btn-primary\">Copy All Result</a> </div>"; 
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",1)\" name=\"copy_succeed_only\" class=\"btn btn-primary\">Copy Succeed Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",2)\" name=\"copy_done_only\" class=\"btn btn-primary\">Copy Done Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",3)\" name=\"copy_fail_only\" class=\"btn btn-primary\">Copy Fail Only</a> </div>";                   
                            tmp+="</div></div></div></div></div>";        
                        }
                        else 
                        {
                            tmp+="<div class=\"col-sm-12 grid-margin\"><div class=\"card\"><div class=\"card-header\"><div class =\"row\"> <input type =\"hidden\" id =\"msg_running_batch_id\"  value =";
                            tmp+= response.batch_array[key]['batch_id']+"> <div class =\"col-sm-1\" id=\"glb_batch_id\">Batch ID:"+ m_cnt+"</div>";
                            tmp+="<div class =\"col-sm-3\" style=\"text-align: center;\">";
                            if(response.batch_array[key]['status'] == "Stopped")
                                tmp+="<a onclick =\"gateLink_get_batch_data(2,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"gateLink_get_batch_status\" style=\"color: red;cursor: pointer;\">Resume the stopped Click here</a></div>"
                            else
                                tmp+="<a onclick =\"gateLink_get_batch_data(3,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"gateLink_get_batch_status\" style=\"color: red;cursor: pointer;\">Retry the Fails ones again click here</a></div>"
                            tmp+="<div class =\"col-sm-3\" style=\"text-align: center;\">Start time:"+response.batch_array[key]['start_time']+"</div>";
                            tmp+="<div class =\"col-sm-3\" style=\"text-align: right;\">Finish time:"+response.batch_array[key]['finish_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" data-toggle=\"collapse\" href=\"#col_gate_link_"+response.batch_array[key]['batch_id']+"\" aria-expanded=\"false\" ><a style=\"cursor: pointer;\">Expand Frame</a></div>";
                            tmp+="</div> </div> <div class=\"card-body\"> <div class =\"row\">";
                            tmp+="<div class =\"col\">Status:"+response.batch_array[key]['status']+"</div>";
                            tmp+="<div class =\"col\">Total:"+response.batch_array[key]['total']+"</div>";
                            tmp+="<div class =\"col\">Successd:"+response.batch_array[key]['succeed']+"</div>"  ;
                            tmp+="<div class =\"col\">Done:"+response.batch_array[key]['done']+"</div>";
                            tmp+="<div class =\"col\">Fails:"+response.batch_array[key]['fail']+"</div>"   ;            
                            tmp+="<div class =\"col\">Remains:"+response.batch_array[key]['remains']+"</div></div>" ;                             
                            tmp+="<div class=\"collapse\" id=\"col_gate_link_"+ response.batch_array[key]['batch_id'] +"\">";
                            tmp+="<div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"><table class=\"table table-bordered\" style=\"text-align: center;\" >";
                            tmp+="<thead><tr><th>Data as Inserted</th><th> SQL Field 1</th><th> SQL Field 2</th><th> SQL Field 3</th><th> SQL Field 4</th><th> SQL Field 5</th><th> Status </th></tr></thead>";
                            tmp+="<tbody style=\"text-align: center;\">";
                            for(kk in response.gate_array)
                            {
                                if(response.gate_array[kk]['batch_id'] == response.batch_array[key]['batch_id'])
                                {
                                    tmp+="<tr><td>"+response.gate_array[kk]['inserted_text']+"</td>"
                                    if(response.gate_array[kk]['status'] == 1)
                                    {
                                        
                                        tmp+="<td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td> Processing</td>";
                                    }
                                    else
                                    {
                                        tmp+="<td>"+response.gate_array[kk]['result1']+"</td><td>"+response.gate_array[kk]['result2']+"</td><td>"+response.gate_array[kk]['result3'];
                                        tmp+="</td><td>"+response.gate_array[kk]['result4']+"</td><td>"+response.gate_array[kk]['result5']+"</td><td>";
                                        if(response.gate_array[kk]['status'] == 0 ) tmp+="In_Queue";
                                        else if(response.gate_array[kk]['status'] == 2) tmp+="Fail";
                                        else if(response.gate_array[kk]['status'] == 3) tmp+="Done";
                                        tmp+="</td>";
                                    }
                                    tmp+="</tr>";
                                }
                            }
                            tmp+="</tbody></table></div>";
                            tmp+="<div style=\"margin-top:10px\"><form><a style=\"margin-right: 2%;color: red;\">Selected row copy data</a><label class=\"checkbox-inline\" style=\"margin-right:1%;\">";
                            tmp+="<input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\"value=\"DI\" checked>Data as Inserted</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"><input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF1\" checked>SQL Field 1</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF2\" checked>SQL Field 2</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF3\" checked>SQL Field 3</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF4\" checked>SQL Field 4</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF5\" checked>SQL Field 5</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"ST\" checked>Status</label></form></div>";
                            tmp+="<div class=\"row\" style=\"text-align:center;\">";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",0)\" name=\"copy_all_result\" class=\"btn btn-primary\">Copy All Result</a> </div>"; 
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",1)\" name=\"copy_succeed_only\" class=\"btn btn-primary\">Copy Succeed Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",2)\" name=\"copy_done_only\" class=\"btn btn-primary\">Copy Done Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",3)\" name=\"copy_fail_only\" class=\"btn btn-primary\">Copy Fail Only</a> </div>";                   
                            tmp+="</div></div></div></div></div>"; 
                        }        
                    }
                  
                    $("#gatelink_batch_data").append(tmp);
                   
                }
                console.log(response);
            },
            error: function(response){
                // alert('An error occured')
            } 
        })
    }
</script>

<div class="content-wrapper">
    <div class="page-header">
        
        <div class = "col-sm-12">
            <div class ="row">
            <div class = "col-sm-4">   
                <img class="img-xs rounded-circle" src={{logo.url}} alt="">         
            </div>
            <div class = "col-sm-4">
                <h5 class="page-title" >
                    {{Name}}
                    <input type ="hidden" name ="now_page_name" id = "now_page_name" value="{{Name}}">
                    <input type = "hidden" name ="input_running_batch_array" id = "input_running_batch_array" value="123">
                </h5>
            </div>
            <div class = "col-sm-4" style="text-align: right;">
               <a>Cost:{{Cost}}USD</a>
            </div>
        </div>
        </div>
    </div>   
    <!-- [ Main Content ] start -->
    <div class="row">
        <!--[Select info] start-->
        <div class="col-sm-12  grid-margin">
            <div class="card">
                <div class="card-header" style="text-align: Center;" >
                    <p style="font-size: 150%;color: #ffffff;">Please select insert format</p>
                </div>
                <div class="card-body">
                    <form >
                        {% for II in link_format %}
                            <div class="custom-control custom-radio" id="testppp">
                                {% if seleted_item == II.Admin_Setting %}
                                <input type="radio" id="{{II}}" name="radio" value = "{{II}}" class="custom-control-input" checked>
                                <label class="custom-control-label" for="{{II}}"> {{II.Members_View_Format}}</label>
                                {% else %}                  
                                <input type="radio" id="{{II}}" name="radio" value = "{{II}}" class="custom-control-input" >
                                <label class="custom-control-label" for="{{II}}"> {{II.Members_View_Format}}</label>
                                {% endif %}
                            </div>
                            <hr>
                        {% endfor %}
                    <p style = "color:red">#-delimiter,any 1 none -alphanumeric symbol(not letter or number)</p>
                    <!--<div style ="text-align:right;">
                        <a onclick="GateLink_Send_Insertd_Data()" name="Gl_Send_InsertData" class="btn btn-primary">Save Fomart</a>
                    </div>--> 
                    </form>
                </div>
                <div class="card-footer">
                    <div style = "text-align:left;">
                        
                    
                        
                    </div>
                </div>
            </div>
        </div>
        <!--[Select info] end-->
        <!--[Gate1 Link] start-->
        <div class="col-sm-12 grid-margin">
            <div class="card">
                <div class = "card-header">
                    <h4>Insert Data</h4>
                   
                </div>
                    <form name ="gatelink_preview_form">
                        
                        <input type ="hidden" name ="status_inserted_format" id = "status_inserted_format" value="">
                        <div class = "card-body">
                            <textarea name="gatelink_previewData_oh" id = "gatelink_previewData_oh" rows="10" cols="30" style="
                            width: 100%;"></textarea>
                            <div style="text-align: right;color: red;" id ="gl_error_preivewData">
                            </div>
                        </div>
                        <div class="card-footer">
                            <div style ="text-align:right;">
                                <a onclick="GateLink_Send_Preview_Data()" name="GateLink_Send_Preview_Data" class="btn btn-primary">Preview Data</a>
                            </div>
                        </div>

                       
                    </form>                                       
            </div>
        </div>
        <!--[Gate1 Link] end-->
        <!--[Preview Data] Start-->
        <div class="col-sm-12 grid-margin"  >
            <div class="card" id = "gatelink_result_data">

            </div>
          
        </div>

        {% if segment == "gate_link_result_error" %}
         <div class="col-sm-12 grid-margin" style="text-align: center;" id = "database_insert_error"> <p  style="color:red;text-align: center;">Error Data Insert,so you have to reinsert data!! </p></div>
       
        {% endif %}
       
       <div class="col-sm-12 grid-margin"  >
            <div class="card" id = "gatelink_batch_data">

            </div>
        </div>
       
       
         <!--{% if Total_Batch != 0 %}
            {% for i in Batch reversed %}
                {% if i.link_name == Name %}
                    {% if i.status == "Running" %}
                        <div class="col-sm-12 grid-margin">
                            <div class="card">
                                <div class="card-header">
                                    <form method="post">
                                        {% csrf_token %}
                                    <div class = "row">
                                       
                                        <input type ="hidden" id ="msg_running_batch_id" value ="{{i.batch_id}}">
                                        <div class ="col-sm-1" id="glb_batch_id">Batch ID:{{i.batch_id}}</div>
                                       
                                        <div class ="col-sm-5" style="text-align: center;"><a type = "submit" name= "status_info" style="color: red;cursor: pointer;">STOP the process of this batch click here</a></div>
                            
                                        <div class ="col-sm-2" style="text-align: center;" id="glb_batch_start_time" >Start time:{{i.start_time}}</div>
                                        <div class ="col-sm-2" style="text-align: right;" id="glb_batch_finish_time">Finish time:{{i.finish_time}}</div>
                                        <div class ="col-sm-2" data-toggle="collapse" href="#col_gate_link_{{forloop.counter}}" aria-expanded="false" ><a style="cursor: pointer;">Expand Frame</a></div>
                                    </div>
                                    </form>
                                </div>
                                <div class="card-body">
                                    <div class = "row">
                                        <div class ="col" id = "glb_batch_status">Status:{{i.status}}</div>
                                        <div class ="col" id = "glb_batch_total">Total:{{i.total}}</div>
                                        <div class ="col" id = "glb_batch_success">Successd:{{i.succeed}}</div>
                                        <div class ="col" id = "glb_batch_done">Done:{{i.done}}</div>
                                        <div class ="col" id = "glb_batch_fail">Fails:{{i.fail}}</div>
                                        <div class ="col" id = "glb_batch_remains">Remains:{{i.remains}}</div>
                                       
                                    </div>
                                    <div class="collapse" id="col_gate_link_{{forloop.counter}}">
                                        <div class="table-responsive" style="overflow-y: auto;max-height: 550px;">
                                            <table class="table table-bordered" style="text-align: center;" >
                                            <thead>
                                                <tr>
                                                    <th>Data as Inserted</th>
                                                    <th> SQL Field 1</th>
                                                    <th> SQL Field 2</th>
                                                    <th> SQL Field 3</th>
                                                    <th> SQL Field 4</th>
                                                    <th> SQL Field 5</th>
                                                    <th> Status </th>
                                                </tr>
                                            </thead>
                                            <tbody id ="glb_gate_body">
                                                
                                            </tbody>
                                            </table>
                                        </div>
                                        <div style="margin-top:10px">
                                            <form>
                                                <a style="margin-right: 2%;color: red;">Selected row copy data</a>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                  <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="DI" checked>Data as Inserted
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                  <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF1" checked>SQL Field 1                                            </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                  <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF2" checked>SQL Field 2 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF3" checked>SQL Field 3 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF4" checked>SQL Field 4 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF5" checked>SQL Field 5
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="ST" checked>Status 
                                                </label>
                                              </form>
                                        </div>
                                        <div class="row" style="text-align:center;">
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',0)" name="copy_all_result" class="btn btn-primary">Copy All Result</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',1)" name="copy_succeed_only" class="btn btn-primary">Copy Succeed Only</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',2)" name="copy_done_only" class="btn btn-primary">Copy Done Only</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',3)" name="copy_fail_only" class="btn btn-primary">Copy Fail Only</a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                                
                            </div> 
                        </div>
                    {%else%}
                        <div class="col-sm-12 grid-margin">
                            <div class="card">
                                <div class="card-header">
                                    <form method="post">
                                        {% csrf_token %}
                                    <div class = "row">
                                      
                                        <div class ="col-sm-1">Batch ID:{{i.batch_id}}</div>
                                      
                                        <div class ="col-sm-5" style="text-align: center;"><button type = "submit" name= "status_info" style="color: red;cursor: pointer;background-color: #191c24;border: inherit;">Retry the Fails ones again click here</a></div>
                                      
                                        <div class ="col-sm-2" style="text-align: center;">Start time:{{i.start_time}}</div>
                                        <div class ="col-sm-2" style="text-align: right;">Finish time:{{i.finish_time}}</div>
                                        <div class ="col-sm-2" data-toggle="collapse" href="#col_gate_link_{{forloop.counter}}" aria-expanded="false" ><a style="cursor: pointer;">Expand Frame</a></div>
                                    </div>
                                </form>
                                </div>
                                <div class="card-body">
                                    <div class = "row">
                                        <div class ="col">Status:{{i.status}}</div>
                                        <div class ="col">Total:{{i.total}}</div>
                                        <div class ="col">Successd:{{i.succeed}}</div>
                                        <div class ="col">Done:{{i.done}}</div>
                                        <div class ="col" id = "glb_batch_fail">Fails:{{i.fail}}</div>
                                        <div class ="col">Remains:{{i.remains}}</div>
                                        
                                    </div>
                                    <div class="collapse" id="col_gate_link_{{forloop.counter}}">
                                        <div class="table-responsive" style="overflow-y: auto;max-height: 550px;">
                                            <table class="table table-bordered"  style="text-align: center;">
                                            <thead>
                                                <tr>
                                                    <th>Data as Inserted</th>
                                                    <th> SQL Field 1</th>
                                                    <th> SQL Field 2</th>
                                                    <th> SQL Field 3</th>
                                                    <th> SQL Field 4</th>
                                                    <th> SQL Field 5</th>
                                                    <th> Status </th>
                                                </tr>
                                            </thead>
                                            <tbody style="text-align: center;">
                                                {% for III in Gate %}
                                                    {% if III.batch_id == i.batch_id %}
                                                        <tr>
                                                            <td> {{III.inserted_text}} </td>
                                                            {% if III.status == 1 %}
                                                            <td> <div class="spinner-border text-muted"></div> </td>
                                                            <td> <div class="spinner-border text-muted"></div> </td>
                                                            <td> <div class="spinner-border text-muted"></div> </td>
                                                            <td> <div class="spinner-border text-muted"></div> </td>
                                                            <td> <div class="spinner-border text-muted"></div> </td>
                                                            <td> Processing</td>
                                                            {% else %}
                                                            <td> {{III.result1}} </td>
                                                            <td> {{III.result2}} </td>
                                                            <td> {{III.result3}} </td>
                                                            <td> {{III.result4}} </td>
                                                            <td> {{III.result5}} </td>
                                                            <td>
                                                                {% if III.status == 0 %} 
                                                                    In_Queue
                                                                {% elif III.status == 2 %}
                                                                    Fail
                                                                {% elif III.status == 3 %}
                                                                    Done
                                                                {% elif III.status == 4 %}
                                                                    Stopped
                                                                {% endif %}
                                                            </td>
                                                            {% endif %}
                                                        </tr>
                                                        
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                            </table>
                                        </div>
                                       
                                        <div style="margin-top:10px">
                                            <form>
                                                <a style="margin-right: 2%;color: red;">Selected row copy data</a>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                  <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="DI" checked>Data as Inserted
                                                </label>
                                                <label class="checkbox-inline"  style="margin-right:1%;">
                                                  <input type="checkbox"  name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF1" checked>SQL Field 1                                            </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                  <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF2" checked>SQL Field 2 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox"  name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF3" checked>SQL Field 3 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF4" checked>SQL Field 4 
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="SF5" checked>SQL Field 5
                                                </label>
                                                <label class="checkbox-inline" style="margin-right:1%;">
                                                    <input type="checkbox" name = "gl_cpy_checkbox_{{i.batch_id}}" value="ST" checked>Status 
                                                </label>
                                              </form>
                                        </div>
                                        <div class="row" style="text-align:center;">
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',0)" name="copy_all_result" class="btn btn-primary">Copy All Result</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',1)" name="copy_succeed_only" class="btn btn-primary">Copy Succeed Only</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',2)" name="copy_done_only" class="btn btn-primary">Copy Done Only</a>
                                            </div>
                                            <div class = "col-sm-3">
                                                <a onclick="copy_result('{{i.batch_id}}',3)" name="copy_fail_only" class="btn btn-primary">Copy Fail Only</a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div> 
                            
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
       
      -->    
    </div>

</div>
<script>
   
/*
    function copy_result(m_batchID,type)//type:0-all,1-Success only ,2-Done only ,3-Fail only 
    {
        var m_checkedStr = "";
        tmpStr = "gl_cpy_checkbox_"+m_batchID;
        m_resulStr="";
        var markedCheckbox = document.getElementsByName(tmpStr);  
        console.log(markedCheckbox);
        var cnt = 0;
        for (var checkbox of markedCheckbox) {  
            if (checkbox.checked)  
            {
                cnt ++;
                if(checkbox.value == "DI")
                    m_resulStr +="Data as Inserted;";
                else if(checkbox.value == "SF1")
                    m_resulStr +="SQL Field 1;";
                else if(checkbox.value == "SF2")
                    m_resulStr +="SQL Field 2;";
                else if(checkbox.value == "SF3")
                    m_resulStr +="SQL Field 3;";   
                else if(checkbox.value == "SF4")
                    m_resulStr+="SQL Field 4;";
                else if(checkbox.value == "SF5")
                    m_resulStr +="SQL Field 5;";
                else if(checkbox.value == "ST")
                    m_resulStr +="status;";
                if(cnt == 1)
                    m_checkedStr += checkbox.value;
                else  m_checkedStr +="#"+ checkbox.value;
            }
        }  
        console.log(m_resulStr);
        if(m_checkedStr == "")
        {
            alert("Please select row");
        } 
        else
        {
            
            $.ajax
            (
                {
                    type: 'POST',
                    url : "/gl_copy_result",
                    data:{
                        seleted_data:m_checkedStr,
                        btType:type,
                        batchID:m_batchID,
                        csrfmiddlewaretoken:getCookie("csrftoken"),
                    },
                    success: function(response){
                        var $temp = $("<textarea>");
                        var sss = m_resulStr + "\r\n"+ response.result;
                        $("body").append($temp);
                        $temp.val(sss).select();
                                 
                        document.execCommand("copy");
                        $temp.remove();
                        console.log(sss)
                        
               
                     
                       
                           
                    },
                    error: function(response){
                        // alert('An error occured')
                    } 
                }
            )
        }
        
    }
    function GateLink_Send_Insertd_Data() {
        var getSelectedValue = document.querySelector( 'input[name="radio"]:checked');   
            if(getSelectedValue == null) 
            {   
                alert("Please Select Insert Format");  
            }  
            else
            {
                document.getElementById('status_inserted_format').value = "ok";
                var tmp_name = document.getElementById('now_page_name').value;
                alert(tmp_name);
                $.ajax({
                        type: 'POST',
                        url : "/Gl_Send_InsertData",
                        data:{
                            name:tmp_name,
                            seleted_data:getSelectedValue.value,
                            message:"FND",
                            csrfmiddlewaretoken:getCookie("csrftoken"),
                        },
                        success: function(response){
                            alert("Success Formart Select")
                            $("#database_insert_error").empty();
                            $("#gl_error_preivewData").empty();
                        },
                        error: function(response){
                           // alert('An error occured')
                        } 
                    }
                )
            }    
                
    }
    function GateLink_Send_Preview_Data() {
        var getSelectedValue = document.querySelector( 'input[name="radio"]:checked');  
        //alert(document.forms["gatelink_preview_form"]["GateLink_Send_Preview_Data"].value);
        str_pre = document.getElementById('gatelink_previewData_oh').value;
        tmp_inserted_data = str_pre.trim().split("\n");
        if(str_pre.trim() == "") return;
        tmp_inserted_real_data = [];
        var cnt = 0;
        for(kk in tmp_inserted_data)
        { 
            tmp_id_str="";
            if(tmp_inserted_data[kk].trim() != "")
            {
                for(kkk in tmp_inserted_data[kk])
                {
                    console.log(tmp_inserted_data[kk][kkk]);
                    if(tmp_inserted_data[kk][kkk]==" ")
                    {   
                        tmp_id_str +="*#*";
                        
                    } 
                    else{
                        tmp_id_str +=tmp_inserted_data[kk][kkk];
                    }
                }
                tmp_inserted_real_data.push(tmp_id_str);
            }

        }
        console.log(tmp_inserted_real_data);
        if(getSelectedValue == null ) 
        {   
            document.getElementById('gl_error_preivewData').innerHTML ="<a >Error!Select Format Check</a>"; 
        }  
        else
        {
            var tmp_name = document.getElementById('now_page_name').value;
            $.ajax({
                    type: 'POST',
                    url : "/GateLink_Send_Preview_Data",
                    data:{
                        page_name:tmp_name,
                        seleted_data:getSelectedValue.value,
                        gatelink_previewData_oo:str_pre,
                        csrfmiddlewaretoken:getCookie("csrftoken"),
                    },
                    success: function(response){
                        $("#database_insert_error").empty();
                        temp_str111="<div class = \"card-body\"><div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"> "    
                        temp_str111+="<table class=\"table table-bordered\" style=\"text-align: center;\"><thead><tr><th>id</th>";
                        for(kk in response.format_array)
                        {
                            temp_str111+="<th>"+response.format_array[kk]+"</th>"
                        }
                        temp_str111+="<th>CHECK</th></tr></thead><tbody>"
                        var tmp_id = 0;
                       
                        for(kk in response.data_array)
                        {
                            //if(response.data_array[kk].error == "count error\r\n") continue;
                               
                            tmp_id = parseInt(kk)+1;
                            var temp_return_str = ""
                            temp_str111+="<tr><td>"+tmp_id.toString()+"</td>";
                                temp_return_str =tmp_inserted_real_data[kk].toString()+"##";
                            
                            for(k in response.format_array)
                            {
                                
                                if(k == 0)
                                {
                                    temp_return_str += response.data_array[kk][response.format_array[k]];
                                    temp_str111+="<td>"+response.data_array[kk][response.format_array[k]]+"<p style=\"text-align: center;color: red;\">";
                                    temp_str111+=response.data_array[kk].error+"</p></td>"
                                } 
                                else
                                {
                                    temp_return_str+="#"+response.data_array[kk][response.format_array[k]];
                                    temp_str111+="<td>"+response.data_array[kk][response.format_array[k]]+"</td>"
                                }
                            }
                            temp_str111+="<td><input type=\"checkbox\" value =" +temp_return_str;
                            if(response.data_array[kk].error == "") 
                            {
                                temp_str111+=" name = \"check\" checked></td></tr>"
                            }
                            else
                            {
                                temp_str111+="></td></tr>"
                            }
                            console.log(temp_return_str);
                                
                        }
                   
                        temp_str111+="</table></div><hr></hr><div style =\"text-align:right;\"><button "
                        temp_str111+="class=\"btn btn-primary\" name=\"gatelink_get_batch_data\" onclick=\"gateLink_get_batch_data(0,0)\"  value=\"ok\" type=\"submit\" >Insert Data</button>"
                        temp_str111+="</div></div>"
                        
                        $("#gatelink_result_data").empty();
                        if(tmp_id != 0 )
                            $("#gatelink_result_data").append(temp_str111);
                    },
                    error: function(response){
                        //alert('An error occured')
                    } 
                }
            )
        }    
                
    }
    function gateLink_get_batch_data(m_type,name,batch_id)
    {
        console.log(m_type);
        console.log(name);
        console.log(batch_id);

        $.ajax
        ({
            type: 'POST',
            url : "/gateLink_get_batch_data",
            data:{
                type:m_type,
                name:name,
                batch_id:batch_id,
                csrfmiddlewaretoken:getCookie("csrftoken"),
            },
            success: function(response){
               // $("#hi_Content").empty();
               
                if(JSON.stringify(response).includes("trans_array"))
                {
                  
                }
                else
                {
                    $("#gatelink_batch_data").empty();
                   
                    tmp="";
                   
                    m_runningBatch_array=[];
                    for(key in response.batch_array)
                    {
                       
                        if(response.batch_array[key]['status'] == "Running")
                        {
                            
                            m_runningBatch_array.push(response.batch_array[key]['batch_id']);
                            tmp+="<div class=\"col-sm-12 grid-margin\"><div class=\"card\"><div class=\"card-header\"><div class =\"row\"> <input type =\"hidden\" id =\"msg_running_batch_id"+response.batch_array[key]['batch_id']+"\"  value =";
                            tmp+= response.batch_array[key]['batch_id']+"> <div class =\"col-sm-1\" id=\"glb_batch_id\">Batch ID:"+ response.batch_array[key]['batch_id']+"</div>";
                            tmp+="<div class =\"col-sm-5\" style=\"text-align: center;\"><a onclick =\"gateLink_get_batch_data(1,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"status_info\" style=\"color: red;cursor: pointer;\">STOP the process of this batch click here</a></div>"
                            tmp+="<div class =\"col-sm-2\" style=\"text-align: center;\" id=\"glb_batch_start_time"+response.batch_array[key]['batch_id']+"\" >Start time:"+response.batch_array[key]['start_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" style=\"text-align: right;\" id=\"glb_batch_finish_time"+response.batch_array[key]['batch_id']+"\">Finish time:"+response.batch_array[key]['finish_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" data-toggle=\"collapse\" href=\"#col_gate_link_"+response.batch_array[key]['batch_id']+"\" aria-expanded=\"false\" ><a style=\"cursor: pointer;\">Expand Frame</a></div>";
                            tmp+="</div> </div> <div class=\"card-body\"> <div class =\"row\">";
                            tmp+="<div class =\"col\" id = \"glb_batch_status"+response.batch_array[key]['batch_id']+"\">Status:"+response.batch_array[key]['status']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_total"+response.batch_array[key]['batch_id']+"\">Total:"+response.batch_array[key]['total']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_success"+response.batch_array[key]['batch_id']+"\">Successd:"+response.batch_array[key]['succeed']+"</div>"  ;
                            tmp+="<div class =\"col\" id = \"glb_batch_done"+response.batch_array[key]['batch_id']+"\">Done:"+response.batch_array[key]['done']+"</div>";
                            tmp+="<div class =\"col\" id = \"glb_batch_fail"+response.batch_array[key]['batch_id']+"\">Fails:"+response.batch_array[key]['fail']+"</div>"   ;            
                            tmp+="<div class =\"col\" id = \"glb_batch_remains"+response.batch_array[key]['batch_id']+"\">Remains:"+response.batch_array[key]['remains']+"</div></div>" ;                             
                            tmp+="<div class=\"collapse\" id=\"col_gate_link_"+ response.batch_array[key]['batch_id'] +"\">";
                            tmp+="<div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"><table class=\"table table-bordered\" style=\"text-align: center;\" >";
                            tmp+="<thead><tr><th>Data as Inserted</th><th> SQL Field 1</th><th> SQL Field 2</th><th> SQL Field 3</th><th> SQL Field 4</th><th> SQL Field 5</th><th> Status </th></tr></thead>";
                            tmp+="<tbody id =\"glb_gate_body\"></tbody></table></div>";
                            tmp+="<div style=\"margin-top:10px\"><form><a style=\"margin-right: 2%;color: red;\">Selected row copy data</a><label class=\"checkbox-inline\" style=\"margin-right:1%;\">";
                            tmp+="<input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\"value=\"DI\" checked>Data as Inserted</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"><input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF1\" checked>SQL Field 1</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF2\" checked>SQL Field 2</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF3\" checked>SQL Field 3</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF4\" checked>SQL Field 4</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF5\" checked>SQL Field 5</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"ST\" checked>Status</label></form></div>";
                            tmp+="<div class=\"row\" style=\"text-align:center;\">";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",0)\" name=\"copy_all_result\" class=\"btn btn-primary\">Copy All Result</a> </div>"; 
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",1)\" name=\"copy_succeed_only\" class=\"btn btn-primary\">Copy Succeed Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",2)\" name=\"copy_done_only\" class=\"btn btn-primary\">Copy Done Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",3)\" name=\"copy_fail_only\" class=\"btn btn-primary\">Copy Fail Only</a> </div>";                   
                            tmp+="</div></div></div></div></div>";        
                        }
                        else 
                        {
                            tmp+="<div class=\"col-sm-12 grid-margin\"><div class=\"card\"><div class=\"card-header\"><div class =\"row\"> <input type =\"hidden\" id =\"msg_running_batch_id\"  value =";
                            tmp+= response.batch_array[key]['batch_id']+"> <div class =\"col-sm-1\" id=\"glb_batch_id\">Batch ID:"+ response.batch_array[key]['batch_id']+"</div>";
                            tmp+="<div class =\"col-sm-5\" style=\"text-align: center;\">";
                            if(response.batch_array[key]['status'] == "Stopped")
                                tmp+="<a onclick =\"gateLink_get_batch_data(2,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"gateLink_get_batch_status\" style=\"color: red;cursor: pointer;\">Resume the stopped Click here</a></div>"
                            else
                                tmp+="<a onclick =\"gateLink_get_batch_data(3,\'{{Name}}\',"+response.batch_array[key]['batch_id']+")\" name= \"gateLink_get_batch_status\" style=\"color: red;cursor: pointer;\">Retry the Fails ones again click here</a></div>"
                            tmp+="<div class =\"col-sm-2\" style=\"text-align: center;\">Start time:"+response.batch_array[key]['start_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" style=\"text-align: right;\">Finish time:"+response.batch_array[key]['finish_time']+"</div>";
                            tmp+="<div class =\"col-sm-2\" data-toggle=\"collapse\" href=\"#col_gate_link_"+response.batch_array[key]['batch_id']+"\" aria-expanded=\"false\" ><a style=\"cursor: pointer;\">Expand Frame</a></div>";
                            tmp+="</div> </div> <div class=\"card-body\"> <div class =\"row\">";
                            tmp+="<div class =\"col\">Status:"+response.batch_array[key]['status']+"</div>";
                            tmp+="<div class =\"col\">Total:"+response.batch_array[key]['total']+"</div>";
                            tmp+="<div class =\"col\">Successd:"+response.batch_array[key]['succeed']+"</div>"  ;
                            tmp+="<div class =\"col\">Done:"+response.batch_array[key]['done']+"</div>";
                            tmp+="<div class =\"col\">Fails:"+response.batch_array[key]['fail']+"</div>"   ;            
                            tmp+="<div class =\"col\">Remains:"+response.batch_array[key]['remains']+"</div></div>" ;                             
                            tmp+="<div class=\"collapse\" id=\"col_gate_link_"+ response.batch_array[key]['batch_id'] +"\">";
                            tmp+="<div class=\"table-responsive\" style=\"overflow-y: auto;max-height: 550px;\"><table class=\"table table-bordered\" style=\"text-align: center;\" >";
                            tmp+="<thead><tr><th>Data as Inserted</th><th> SQL Field 1</th><th> SQL Field 2</th><th> SQL Field 3</th><th> SQL Field 4</th><th> SQL Field 5</th><th> Status </th></tr></thead>";
                            tmp+="<tbody style=\"text-align: center;\">";
                            for(kk in response.gate_array)
                            {
                                if(response.gate_array[kk]['batch_id'] == response.batch_array[key]['batch_id'])
                                {
                                    tmp+="<tr><td>"+response.gate_array[kk]['inserted_text']+"</td>"
                                    if(response.gate_array[kk]['status'] == 1)
                                    {
                                        
                                        tmp+="<td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td><div class=\"spinner-border text-muted\"></div> </td><td> Processing</td>";
                                    }
                                    else
                                    {
                                        tmp+="<td>"+response.gate_array[kk]['result1']+"</td><td>"+response.gate_array[kk]['result2']+"</td><td>"+response.gate_array[kk]['result3'];
                                        tmp+="</td><td>"+response.gate_array[kk]['result4']+"</td><td>"+response.gate_array[kk]['result5']+"</td><td>";
                                        if(response.gate_array[kk]['status'] == 0 ) tmp+="In_Queue";
                                        else if(response.gate_array[kk]['status'] == 2) tmp+="Fail";
                                        else if(response.gate_array[kk]['status'] == 3) tmp+="Done";
                                        tmp+="</td>";
                                    }
                                    tmp+="</tr>";
                                }
                            }
                            tmp+="</tbody></table></div>";
                            tmp+="<div style=\"margin-top:10px\"><form><a style=\"margin-right: 2%;color: red;\">Selected row copy data</a><label class=\"checkbox-inline\" style=\"margin-right:1%;\">";
                            tmp+="<input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\"value=\"DI\" checked>Data as Inserted</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"><input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF1\" checked>SQL Field 1</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF2\" checked>SQL Field 2</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF3\" checked>SQL Field 3</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF4\" checked>SQL Field 4</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"SF5\" checked>SQL Field 5</label>";
                            tmp+="<label class=\"checkbox-inline\" style=\"margin-right:1%;\"> <input type=\"checkbox\" name = \"gl_cpy_checkbox_"+response.batch_array[key]['batch_id']+"\" value=\"ST\" checked>Status</label></form></div>";
                            tmp+="<div class=\"row\" style=\"text-align:center;\">";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",0)\" name=\"copy_all_result\" class=\"btn btn-primary\">Copy All Result</a> </div>"; 
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",1)\" name=\"copy_succeed_only\" class=\"btn btn-primary\">Copy Succeed Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",2)\" name=\"copy_done_only\" class=\"btn btn-primary\">Copy Done Only</a> </div>";
                            tmp+="<div class = \"col-sm-3\"><a onclick=\"copy_result("+response.batch_array[key]['batch_id'] +",3)\" name=\"copy_fail_only\" class=\"btn btn-primary\">Copy Fail Only</a> </div>";                   
                            tmp+="</div></div></div></div></div>"; 
                        }        
                    }
                  
                    $("#gatelink_batch_data").append(tmp);
                   
                }
                console.log(response);
            },
            error: function(response){
                // alert('An error occured')
            } 
        })
    }*/
</script>
{% endblock content %}
